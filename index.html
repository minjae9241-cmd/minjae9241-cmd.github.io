<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“±í•™ê¸‰ ê²½ì˜ ë„ìš°ë¯¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* --- ì´ˆê¸°í™” ë° ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Jua', sans-serif;
            background-color: #FFFDE7;
            /* ê·€ì—¬ìš´ ë…¸ë‘ */
            color: #5D4037;
            padding: 20px;
        }

        h1 {
            font-size: 3.5rem;
            text-align: center;
            color: #5D4037;
            text-shadow: 2px 2px 0px #FFF9C4;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 2rem;
            color: #5D4037;
            margin-bottom: 15px;
            border-bottom: 3px dashed #FBC02D;
            padding-bottom: 10px;
            text-align: center;
        }

        h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-align: center;
        }

        button {
            font-family: 'Jua', sans-serif;
            cursor: pointer;
            border: none;
            outline: none;
        }

        /* --- ê³µí†µ ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼ --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .home-btn-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 40px;
        }

        .home-btn {
            width: 300px;
            height: 250px;
            background-color: #FFFFFF;
            border: 4px solid #FBC02D;
            border-radius: 30px;
            box-shadow: 5px 5px 0px 0px #F9A825;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: transform 0.2s, background-color 0.2s;
            padding: 20px;
        }

        .home-btn:hover {
            transform: scale(1.03);
            background-color: #FFF9C4;
        }

        .home-btn-title {
            font-size: 2.0rem;
            /* ë‘ ì¤„ ë°©ì§€ ìœ„í•´ ì¶•ì†Œ (2.5 -> 2.0) */
            font-weight: bold;
            margin-bottom: 10px;
            color: #3E2723;
        }

        .home-btn-desc {
            font-size: 1.2rem;
            color: #5D4037;
            line-height: 1.4;
        }

        .nav-btn {
            background-color: #fff;
            border: 2px solid #FBC02D;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 1rem;
            margin-bottom: 20px;
            box-shadow: 2px 2px 0 #F9A825;
        }

        .nav-btn:hover {
            background-color: #FFF9C4;
        }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        input[type="text"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 3px solid #FBC02D;
            border-radius: 15px;
            font-family: 'Jua', sans-serif;
            font-size: 1rem;
            background-color: #FFFFFF;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #F57F17;
        }

        button.action-btn {
            background-color: #FBC02D;
            color: #3E2723;
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 1.1rem;
            box-shadow: 2px 2px 0 #F57F17;
        }

        button.action-btn:hover {
            background-color: #F9A825;
            color: #fff;
        }

        button.delete-btn {
            background-color: #FFCCBC;
            border: 2px solid #FF5722;
            color: #BF360C;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        /* --- í˜ì´ì§€ë³„ ìŠ¤íƒ€ì¼ --- */
        .page {
            display: none;
            /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
            animation: fadeIn 0.3s;
            text-align: center;
            /* ëª¨ë“  í…ìŠ¤íŠ¸ ê°€ìš´ë° ì •ë ¬ */
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .active {
            display: block;
        }

        /* ì˜¤ëŠ˜ì˜ ìš°ë¦¬ë°˜ ì¹´ë“œ */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        @media (max-width: 768px) {
            .grid-4 {
                grid-template-columns: 1fr 1fr;
            }
        }

        .info-card {
            background-color: #f0f2f6;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid;
            min-height: 150px;
            white-space: pre-wrap;
            /* ì¤„ë°”ê¿ˆ ì ìš© */
        }

        .card-red {
            border-left-color: #ff4b4b;
        }

        .card-green {
            border-left-color: #4caf50;
        }

        .card-orange {
            border-left-color: #ff9800;
        }

        .card-blue {
            border-left-color: #2196f3;
        }

        .info-title {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 10px;
            display: block;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-menu {
            display: flex;
            border-bottom: 3px solid #ddd;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none;
            font-size: 1.2rem;
            color: #888;
            border-bottom: 3px solid transparent;
            margin-bottom: -3px;
        }

        .tab-btn.active-tab {
            color: #5D4037;
            border-bottom-color: #FBC02D;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active-content {
            display: block;
        }

        /* ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .list-item {
            display: flex;
            justify-content: center;
            /* flex container center alignment */
            gap: 15px;
            /* Add gap between name and button */
            align-items: center;
            background-color: white;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 10px;
            border: 1px solid #eee;
        }

        /* ìë¦¬ ë°°ì¹˜ ê·¸ë¦¬ë“œ */
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            /* 3ë¶„ë‹¨ */
            gap: 40px;
            /* ë¶„ë‹¨ ê°„ ê°„ê²© ë„“ê²Œ */
            margin-top: 20px;
        }

        .seat-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* 2ëª…ì”© (ì§ê¿) */
            gap: 10px;
        }

        .seat-item {
            padding: 20px 5px;
            background-color: #e3f2fd;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #90caf9;
            font-weight: bold;
            min-height: 80px;
            /* ë†’ì´ ê³ ì •ìœ¼ë¡œ ê¹”ë”í•˜ê²Œ */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì„±ì¥ ì¼ì§€ */
        .log-item {
            background-color: #fff;
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .log-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .log-author {
            font-weight: bold;
            color: #3E2723;
        }

        .teacher-comment-box {
            background-color: #E8F5E9;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>

<body>

    <div class="container">
        <!-- í—¤ë” / íƒ€ì´í‹€ -->
        <h1 id="main-title">ğŸ  êµ°ê³ êµ¬ë§ˆë°˜ì˜ í–‰ë³µí•œ í•˜ë£¨í•˜ë£¨ ğŸ </h1>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ (í™ˆì—ì„œëŠ” ìˆ¨ê¹€) -->
        <div id="navigation" style="display:none;">
            <button class="nav-btn" onclick="goHome()">ğŸ  í™ˆìœ¼ë¡œ ê°€ê¸°</button>
            <hr style="border: 0; border-top: 2px dashed #ddd; margin: 15px 0;">
        </div>

        <!-- 1. ë©”ì¸ í™ˆ í™”ë©´ -->
        <div id="page-home" class="page active">
            <div class="home-btn-group">
                <button class="home-btn" onclick="goToPage('today')">
                    <div class="home-btn-title">ğŸ« ì˜¤ëŠ˜ì˜ ìš°ë¦¬ë°˜</div>
                    <div class="home-btn-desc">ì¼ì •, ê¸‰ì‹, ì•Œë¦¼ì¥</div>
                </button>
                <button class="home-btn" onclick="goToPage('management')">
                    <div class="home-btn-title">ğŸ“‹ ì´ ë‹¬ì˜ ìš°ë¦¬ë°˜</div>
                    <div class="home-btn-desc">í•™ìƒ ëª…ë‹¨, ìë¦¬ ë°°ì¹˜</div>
                </button>
                <button class="home-btn" onclick="goToPage('growth')">
                    <div class="home-btn-title">ğŸŒ± ì„±ì¥ ì¼ì§€</div>
                    <div class="home-btn-desc">í•˜ë£¨ ê¸°ë¡, ì„ ìƒë‹˜ ì‘ì›</div>
                </button>
            </div>

            <!-- ë°ì´í„° ë°±ì—…/ë³µì› ì„¹ì…˜ -->
            <div
                style="margin-top: 50px; text-align: center; padding: 20px; background-color: #FFF9C4; border-radius: 20px; border: 3px dashed #FBC02D;">
                <h3 style="color: #5D4037; margin-bottom: 15px;">ğŸ’¾ ë°ì´í„° ê´€ë¦¬ (ë°±ì—…/ë³µì›)</h3>
                <p style="margin-bottom: 15px; font-size: 0.9rem; color: #795548;">ë°ì´í„°ë¥¼ ì»´í“¨í„°ì— ì €ì¥í•˜ê±°ë‚˜, ì €ì¥ëœ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆì–´ìš”.
                </p>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="action-btn" style="background-color: #4CAF50; color: white;"
                        onclick="exportData()">ğŸ“¤ ë°ì´í„° ì €ì¥í•˜ê¸° (ë‚´ë³´ë‚´ê¸°)</button>
                    <button class="action-btn" style="background-color: #2196F3; color: white;"
                        onclick="document.getElementById('import-file').click()">ğŸ“¥ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ê°€ì ¸ì˜¤ê¸°)</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;"
                        onchange="importData(event)">
                </div>
            </div>
        </div>

        <!-- 2. ì˜¤ëŠ˜ì˜ ìš°ë¦¬ë°˜ í™”ë©´ -->
        <div id="page-today" class="page">
            <h2>ğŸ« ì˜¤ëŠ˜ì˜ ìš°ë¦¬ë°˜</h2>

            <div style="margin-bottom: 20px; text-align: center;">
                <label style="font-size: 1.2rem; margin-right: 10px;">ğŸ“… ë‚ ì§œ ì„ íƒ:</label>
                <input type="date" id="daily-date-picker" style="width: auto;" onchange="loadDailyLog()">
            </div>

            <details open
                style="margin-bottom: 30px; background-color: #fff; padding: 20px; border-radius: 15px; border: 2px solid #FBC02D;">
                <summary
                    style="font-size: 1.2rem; font-weight: bold; cursor: pointer; color: #F57F17; margin-bottom: 10px;">
                    ğŸ“ ì„ ìƒë‹˜ ê¸°ë¡ì¥ (í´ë¦­í•˜ì—¬ ì—´ê¸°/ì ‘ê¸°)</summary>
                <div class="grid-2">
                    <div>
                        <label>ğŸ•’ í•™ê¸‰ ì¼ê³¼</label>
                        <textarea id="input-schedule" rows="4"></textarea>
                    </div>
                    <div>
                        <label>ğŸ± ì˜¤ëŠ˜ì˜ ê¸‰ì‹</label>
                        <textarea id="input-lunch" rows="4"></textarea>
                    </div>
                    <div>
                        <label>âœ… ê¼­ í•´ì•¼ í•  ì¼</label>
                        <textarea id="input-todo" rows="4"></textarea>
                    </div>
                    <div>
                        <label>ğŸ’ ì¤€ë¹„ë¬¼</label>
                        <textarea id="input-supplies" rows="4"></textarea>
                    </div>
                </div>
                <div style="text-align: right;">
                    <button class="action-btn" onclick="saveDailyLog()">ì €ì¥í•˜ê¸°</button>
                </div>
            </details>

            <div id="daily-display-area">
                <h3 id="daily-display-title" style="text-align: center; margin-bottom: 20px;"></h3>
                <div class="grid-4" id="daily-cards">
                    <!-- ì¹´ë“œ ë‚´ìš©ì´ JSë¡œ ë“¤ì–´ê° -->
                </div>
            </div>
        </div>

        <!-- 3. ì´ ë‹¬ì˜ ìš°ë¦¬ë°˜ í™”ë©´ -->
        <div id="page-management" class="page">
            <h2>ğŸ“‹ ì´ ë‹¬ì˜ ìš°ë¦¬ë°˜</h2>

            <div class="tab-menu">
                <button class="tab-btn active-tab" onclick="openTab('tab-students')">ğŸ‘¨â€ğŸ“ í•™ìƒ ëª…ë‹¨</button>
                <button class="tab-btn" onclick="openTab('tab-seats')">ğŸª‘ ìë¦¬ ë°°ì¹˜</button>
                <button class="tab-btn" onclick="openTab('tab-roles')">ğŸ§¹ 1ì¸ 1ì—­</button>
            </div>

            <!-- íƒ­ 1: í•™ìƒ ëª…ë‹¨ -->
            <div id="tab-students" class="tab-content active-content">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="new-student-name" placeholder="í•™ìƒ ì´ë¦„ ì…ë ¥" style="flex: 1; margin-bottom: 0;">
                    <button class="action-btn" onclick="addStudent()">ì¶”ê°€</button>
                </div>
                <div id="student-list">
                    <!-- í•™ìƒ ëª©ë¡ ë Œë”ë§ -->
                </div>
            </div>

            <!-- íƒ­ 2: ìë¦¬ ë°°ì¹˜ -->
            <div id="tab-seats" class="tab-content">
                <div style="margin-bottom: 20px;">
                    <button class="action-btn" onclick="shuffleSeats()">ğŸ² ìë¦¬ ë°°ì¹˜í•˜ê¸°</button>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">* í•™ìƒ ëª…ë‹¨ì— ìˆëŠ” ì¹œêµ¬ë“¤ì„ ë¬´ì‘ìœ„ë¡œ ì„ìŠµë‹ˆë‹¤.</p>
                </div>
                <div id="seat-container" class="seat-grid">
                    <!-- ìë¦¬ ë°°ì¹˜ ë Œë”ë§ -->
                </div>
            </div>

            <!-- íƒ­ 3: 1ì¸ 1ì—­ -->
            <div id="tab-roles" class="tab-content">
                <div style="margin-bottom: 20px;">
                    <button class="action-btn" onclick="assignRoles()">ğŸ² ëœë¤ ë°°ì •í•˜ê¸°</button>
                    <button class="action-btn" style="background-color: #FF5722; color: white; margin-left: 10px;"
                        onclick="resetRoles()">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
                <div id="role-list" class="grid-2">
                    <!-- ì—­í•  ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ -->
                </div>
            </div>
        </div>

        <!-- 4. ì„±ì¥ ì¼ì§€ í™”ë©´ -->
        <div id="page-growth" class="page">
            <h2>ğŸŒ± ì„±ì¥ ì¼ì§€</h2>

            <div style="text-align: center; margin-bottom: 20px;">
                <label>
                    <input type="radio" name="user-mode" value="student" checked onchange="toggleGrowthMode()"> ğŸ‘¦ í•™ìƒìš©
                </label>
                <label style="margin-left: 20px;">
                    <input type="radio" name="user-mode" value="teacher" onchange="toggleGrowthMode()"> ğŸ‘©â€ğŸ« êµì‚¬ìš©
                </label>
            </div>
            <hr style="margin-bottom: 20px; border-color: #eee;">

            <!-- í•™ìƒ ëª¨ë“œ -->
            <div id="growth-student-mode">
                <h3>ğŸ“ ë‚˜ì˜ í•˜ë£¨ ê¸°ë¡í•˜ê¸°</h3>
                <input type="text" id="growth-student-name" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <textarea id="growth-content" rows="4" placeholder="ì˜¤ëŠ˜ ìˆì—ˆë˜ íŠ¹ë³„í•œ ì¼ì´ë‚˜ ë°°ìš´ ì ì„ ê¸°ë¡í•´ë³´ì„¸ìš”."></textarea>
                <button class="action-btn" onclick="addGrowthLog()">ì¼ê¸° ì €ì¥í•˜ê¸°</button>

                <div style="margin-top: 40px;">
                    <h3>ğŸ“‚ ë‚´ê°€ ì“´ ê¸€ í™•ì¸</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="growth-search-name" placeholder="ì´ë¦„ ì…ë ¥ í›„ ì¡°íšŒ"
                            style="margin-bottom:0; width: 200px;">
                        <button class="action-btn" onclick="loadStudentLogs()">ì¡°íšŒ</button>
                    </div>
                    <div id="my-logs-container" style="margin-top: 15px;"></div>
                </div>
            </div>

            <!-- êµì‚¬ ëª¨ë“œ -->
            <div id="growth-teacher-mode" style="display: none;">
                <h3>ğŸ‘¨â€ğŸ« ìš°ë¦¬ë°˜ ì¹œêµ¬ë“¤ì˜ ì´ì•¼ê¸°</h3>
                <div id="all-logs-container"></div>
            </div>
        </div>

    </div>

    <script>
        // --- ë°ì´í„° ê´€ë¦¬ (LocalStorage) ---
        const DB = {
            // ì¼ì¼ ê¸°ë¡
            getDailyLog: (date) => JSON.parse(localStorage.getItem(`daily_${date}`) || 'null'),
            saveDailyLog: (date, data) => localStorage.setItem(`daily_${date}`, JSON.stringify(data)),

            // í•™ìƒ ëª…ë‹¨ (ë‹¨ìˆœ ë°°ì—´)
            getStudents: () => JSON.parse(localStorage.getItem('students') || '[]'),
            saveStudents: (list) => localStorage.setItem('students', JSON.stringify(list)),

            // ìë¦¬ ë°°ì¹˜
            getSeats: () => JSON.parse(localStorage.getItem('seats') || '[]'),
            saveSeats: (list) => localStorage.setItem('seats', JSON.stringify(list)),

            // 1ì¸ 1ì—­
            getRoles: () => JSON.parse(localStorage.getItem('roles') || '{}'),
            saveRoles: (roles) => localStorage.setItem('roles', JSON.stringify(roles)),

            // ì„±ì¥ ì¼ì§€ ({id, date, name, content, comment, timestamp})
            getGrowthLogs: () => JSON.parse(localStorage.getItem('growth_logs') || '[]'),
            saveGrowthLogs: (logs) => localStorage.setItem('growth_logs', JSON.stringify(logs))
        };

        // --- ë°ì´í„° ë°±ì—… ë° ë³µì› ---
        function exportData() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data[key] = localStorage.getItem(key);
            }
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `class_data_backup_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm("í˜„ì¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ì§€ìš°ê³  ë°±ì—… íŒŒì¼ë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                        localStorage.clear();
                        for (const key in data) {
                            localStorage.setItem(key, data[key]);
                        }
                        alert("ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.");
                        location.reload();
                    }
                } catch (error) {
                    alert("ì˜ëª»ëœ íŒŒì¼ í˜•ì‹ì´ê±°ë‚˜ ì†ìƒëœ íŒŒì¼ì…ë‹ˆë‹¤.");
                }
            };
            reader.readAsText(file);
        }

        // --- ë„¤ë¹„ê²Œì´ì…˜ ---
        function goHome() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-home').classList.add('active');
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('main-title').innerText = "ğŸ  êµ°ê³ êµ¬ë§ˆë°˜ì˜ í–‰ë³µí•œ í•˜ë£¨í•˜ë£¨ ğŸ ";
        }

        function goToPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${pageName}`).classList.add('active');
            document.getElementById('navigation').style.display = 'block';

            // í˜ì´ì§€ë³„ ì´ˆê¸°í™” ë¡œì§
            if (pageName === 'today') {
                document.getElementById('daily-date-picker').valueAsDate = new Date();
                loadDailyLog();
            } else if (pageName === 'management') {
                loadStudents();
                loadSeats();
                loadRoles(); // 1ì¸ 1ì—­ ë¡œë“œ ì¶”ê°€
            }
        }

        // --- ê¸°ëŠ¥: ì˜¤ëŠ˜ì˜ ìš°ë¦¬ë°˜ ---
        function loadDailyLog() {
            const date = document.getElementById('daily-date-picker').value;
            const data = DB.getDailyLog(date);
            const container = document.getElementById('daily-cards');
            const title = document.getElementById('daily-display-title');

            // ì…ë ¥ì°½ ì±„ìš°ê¸°
            document.getElementById('input-schedule').value = data ? data.schedule : "";
            document.getElementById('input-lunch').value = data ? data.lunch : "";
            document.getElementById('input-todo').value = data ? data.todo : "";
            document.getElementById('input-supplies').value = data ? data.supplies : "";

            // ë””ìŠ¤í”Œë ˆì´ ì˜ì—­ ì—…ë°ì´íŠ¸
            title.innerText = `ğŸ“… ${date} ì•Œë¦¼ì¥`;

            if (data) {
                container.innerHTML = `
                    <div class="info-card card-red"><span class="info-title">ğŸ•’ í•™ê¸‰ ì¼ê³¼</span>${formatText(data.schedule)}</div>
                    <div class="info-card card-green"><span class="info-title">ğŸ± ì˜¤ëŠ˜ì˜ ê¸‰ì‹</span>${formatText(data.lunch)}</div>
                    <div class="info-card card-orange"><span class="info-title">âœ… ê¼­ í•´ì•¼ í•  ì¼</span>${formatText(data.todo)}</div>
                    <div class="info-card card-blue"><span class="info-title">ğŸ’ ì¤€ë¹„ë¬¼</span>${formatText(data.supplies)}</div>
                `;
            } else {
                container.innerHTML = `<div style="grid-column: span 4; text-align: center; color: #888; padding: 20px;">ğŸ“ ì•„ì§ ë“±ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>`;
            }
        }

        function saveDailyLog() {
            const date = document.getElementById('daily-date-picker').value;
            if (!date) return alert("ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");

            const data = {
                schedule: document.getElementById('input-schedule').value,
                lunch: document.getElementById('input-lunch').value,
                todo: document.getElementById('input-todo').value,
                supplies: document.getElementById('input-supplies').value
            };

            DB.saveDailyLog(date, data);
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
            loadDailyLog();
        }

        function formatText(text) {
            return text ? text.replace(/\n/g, '<br>') : '-';
        }

        // --- ê¸°ëŠ¥: ì´ ë‹¬ì˜ ìš°ë¦¬ë°˜ ---
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active-content'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active-tab'));

            document.getElementById(tabId).classList.add('active-content');
            event.target.classList.add('active-tab');
        }

        function loadStudents() {
            const list = DB.getStudents();
            const container = document.getElementById('student-list');
            container.innerHTML = list.length === 0 ? '<p style="text-align:center; color:#999;">ë“±ë¡ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>' : '';

            list.forEach((name, index) => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <span>${index + 1}. ${name}</span>
                    <button class="delete-btn" onclick="deleteStudent(${index})">ì‚­ì œ</button>
                `;
                container.appendChild(item);
            });
        }

        function addStudent() {
            const input = document.getElementById('new-student-name');
            const name = input.value.trim();
            if (!name) return;

            const list = DB.getStudents();
            list.push(name);
            DB.saveStudents(list);
            input.value = '';
            loadStudents();
        }

        function deleteStudent(index) {
            if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
            const list = DB.getStudents();
            list.splice(index, 1);
            DB.saveStudents(list);
            loadStudents();
        }

        function loadSeats() {
            const seats = DB.getSeats();
            const container = document.getElementById('seat-container');
            container.innerHTML = '';

            if (seats.length === 0) {
                container.innerHTML = '<div style="grid-column: span 3; text-align:center; color:#999;">ì•„ì§ ìë¦¬ ë°°ì¹˜ê°€ ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // 2ëª…ì”© ì§ì§€ì–´ì„œ 3ë¶„ë‹¨ìœ¼ë¡œ ë°°ì¹˜ (ì´ 3ê°œì˜ í° ì»¬ëŸ¼)
            // seats ë°°ì—´ì„ ì•ì—ì„œë¶€í„° 2ê°œì”© ë¬¶ì–´ì„œ seat-groupìœ¼ë¡œ ë§Œë“¦
            for (let i = 0; i < seats.length; i += 2) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'seat-group';

                // ì²« ë²ˆì§¸ ìë¦¬
                const seat1 = document.createElement('div');
                seat1.className = 'seat-item';
                seat1.innerText = seats[i];
                groupDiv.appendChild(seat1);

                // ë‘ ë²ˆì§¸ ìë¦¬ (ìˆìœ¼ë©´)
                if (i + 1 < seats.length) {
                    const seat2 = document.createElement('div');
                    seat2.className = 'seat-item';
                    seat2.innerText = seats[i + 1];
                    groupDiv.appendChild(seat2);
                } else {
                    // í™€ìˆ˜ë¼ì„œ ì§ì´ ì—†ëŠ” ê²½ìš° ë¹ˆ ë°•ìŠ¤? ì•„ë‹ˆë©´ ê·¸ëƒ¥ ë¹„ì›€.
                    // ëª¨ì–‘ ìœ ì§€ë¥¼ ìœ„í•´ ë¹ˆ íˆ¬ëª… ë°•ìŠ¤ ì¶”ê°€ ê°€ëŠ¥í•˜ë‚˜, ì¼ë‹¨ ë¹„ì›Œë‘ .
                }

                container.appendChild(groupDiv);
            }
        }

        function shuffleSeats() {
            const students = DB.getStudents();
            if (students.length === 0) return alert("í•™ìƒ ëª…ë‹¨ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!");

            // ë°°ì—´ ì„ê¸° (Fisher-Yates shuffle)
            const shuffled = [...students];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }

            DB.saveSeats(shuffled);
            loadSeats();
            alert("ìë¦¬ê°€ ì„ì˜€ìŠµë‹ˆë‹¤!");
        }

        // --- ê¸°ëŠ¥: 1ì¸ 1ì—­ ---
        const DEFAULT_ROLES = [
            "ë°˜ì¥", "ë¶€ë°˜ì¥", "ì¤„ ë°˜ì¥", "ê¸‰ì‹ ë„ìš°ë¯¸", "ìš°ìœ  ë„ìš°ë¯¸",
            "ì¹ íŒ ì§€ìš°ê°œ", "ì°½ë¬¸ ë‹¹ë²ˆ", "ë¶ˆ ë„ê¸°/ì¼œê¸°", "ì»´í“¨í„° ê´€ë¦¬", "êµì‹¤ ì²­ì†Œ ëŒ€ì¥",
            "ë³µë„ í†µí–‰ ì§€ë„", "ì¤€ë¹„ë¬¼ ê²€ì‚¬", "ìˆ™ì œ ê±·ê¸°", "ì•Œë¦¼ì¥ ì“°ê¸° ë„ì›€", "ì±…ì¥ ì •ë¦¬",
            "ë¶„ë¦¬ìˆ˜ê±°", "í™”ë¶„ ë¬¼ ì£¼ê¸°", "ì²´ìœ¡ ë¶€ì¥", "ë„ì„œ ë¶€ì¥", "ë³´ê±´ ë¶€ì¥"
        ];

        function loadRoles() {
            const savedRoles = DB.getRoles();
            const container = document.getElementById('role-list');
            container.innerHTML = '';

            // ê¸°ë³¸ ì—­í• ì— ì €ì¥ëœ í•™ìƒ ë§¤í•‘
            DEFAULT_ROLES.forEach((role, index) => {
                const studentName = savedRoles[role] || "ë¯¸ë°°ì •";
                const isAssigned = savedRoles[role] ? 'assigned' : '';

                const item = document.createElement('div');
                item.className = 'list-item'; // ì¬ì‚¬ìš©
                item.style.flexDirection = 'column';
                item.style.gap = '5px';

                item.innerHTML = `
                    <div style="font-weight: bold; font-size: 1.1rem; color: #5D4037;">${role}</div>
                    <div style="font-size: 1.2rem; color: #1E88E5; cursor: pointer;" onclick="updateRole('${role}')">
                        ${studentName}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function updateRole(role) {
            const savedRoles = DB.getRoles();
            const current = savedRoles[role] || "";
            const newName = prompt(`'${role}' ì—­í• ì„ ë§¡ì„ í•™ìƒì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.\n(í˜„ì¬: ${current})`, current);

            if (newName !== null) {
                if (newName.trim() === "") {
                    delete savedRoles[role];
                } else {
                    savedRoles[role] = newName.trim();
                }
                DB.saveRoles(savedRoles);
                loadRoles();
            }
        }

        function assignRoles() {
            const students = DB.getStudents();
            if (students.length === 0) return alert("í•™ìƒ ëª…ë‹¨ì„ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”!");

            if (!confirm("í˜„ì¬ ë°°ì •ì„ ì´ˆê¸°í™”í•˜ê³  ë¬´ì‘ìœ„ë¡œ ìƒˆë¡œ ë°°ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            // í•™ìƒ ì„ê¸°
            const shuffledStudents = [...students];
            for (let i = shuffledStudents.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledStudents[i], shuffledStudents[j]] = [shuffledStudents[j], shuffledStudents[i]];
            }

            // ì—­í• ì— ìˆœì„œëŒ€ë¡œ ë°°ì • (í•™ìƒ ìˆ˜ê°€ ì—­í•  ìˆ˜ë³´ë‹¤ ì ê±°ë‚˜ ë§ì„ ìˆ˜ ìˆìŒ)
            const newRoles = {};
            DEFAULT_ROLES.forEach((role, index) => {
                if (index < shuffledStudents.length) {
                    newRoles[role] = shuffledStudents[index];
                } else {
                    // í•™ìƒ ìˆ˜ê°€ ëª¨ìë¼ë©´ ë¯¸ë°°ì •ìœ¼ë¡œ ë‚¨ê¹€ (ë˜ëŠ” ë¡œí…Œì´ì…˜ ë¡œì§ ê°€ëŠ¥í•˜ë‚˜ ì¼ë‹¨ ë¹„ì›€)
                }
            });

            DB.saveRoles(newRoles);
            loadRoles();
            alert("ì—­í• ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }

        function resetRoles() {
            if (confirm("ì •ë§ë¡œ ëª¨ë“  ì—­í•  ë°°ì •ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                DB.saveRoles({});
                loadRoles();
            }
        }

        // --- ê¸°ëŠ¥: ì„±ì¥ ì¼ì§€ ---
        function toggleGrowthMode() {
            const mode = document.querySelector('input[name="user-mode"]:checked').value;
            if (mode === 'student') {
                document.getElementById('growth-student-mode').style.display = 'block';
                document.getElementById('growth-teacher-mode').style.display = 'none';

                // í•™ìƒ ì´ë¦„ ê¸°ì–µí•˜ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
                const savedName = localStorage.getItem('last_student_name');
                if (savedName) document.getElementById('growth-student-name').value = savedName;
                document.getElementById('growth-search-name').value = savedName || '';

            } else {
                document.getElementById('growth-student-mode').style.display = 'none';
                document.getElementById('growth-teacher-mode').style.display = 'block';
                loadAllLogsForTeacher();
            }
        }

        function addGrowthLog() {
            const name = document.getElementById('growth-student-name').value.trim();
            const content = document.getElementById('growth-content').value.trim();

            if (!name || !content) return alert("ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const logs = DB.getGrowthLogs();
            const newLog = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                name: name,
                content: content,
                comment: ""
            };

            logs.unshift(newLog); // ìµœì‹ ìˆœ
            DB.saveGrowthLogs(logs);

            // ì´ë¦„ ê¸°ì–µ
            localStorage.setItem('last_student_name', name);
            document.getElementById('growth-content').value = '';
            alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");

            // ë°”ë¡œ ë‚´ ê¸€ ì¡°íšŒ ê°±ì‹ 
            document.getElementById('growth-search-name').value = name;
            loadStudentLogs();
        }

        function loadStudentLogs() {
            const name = document.getElementById('growth-student-name').value.trim() || document.getElementById('growth-search-name').value.trim();
            if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

            const logs = DB.getGrowthLogs().filter(log => log.name === name);
            const container = document.getElementById('my-logs-container');
            container.innerHTML = logs.length ? '' : '<p>ì‘ì„±ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

            logs.forEach(log => {
                container.innerHTML += `
                    <div class="log-item">
                        <div class="log-date">${log.date}</div>
                        <div style="white-space: pre-wrap;">${log.content}</div>
                        ${log.comment ? `<div class="teacher-comment-box">ğŸ‘©â€ğŸ« ì„ ìƒë‹˜: ${log.comment}</div>` : ''}
                    </div>
                `;
            });
        }

        function loadAllLogsForTeacher() {
            const logs = DB.getGrowthLogs();
            const container = document.getElementById('all-logs-container');
            container.innerHTML = logs.length ? '' : '<p>ì•„ì§ ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';

            logs.forEach(log => {
                const div = document.createElement('div');
                div.className = 'log-item';
                div.innerHTML = `
                    <div class="log-date">[${log.date}] <span class="log-author">${log.name}</span> í•™ìƒ</div>
                    <div style="white-space: pre-wrap; margin-bottom: 10px;">${log.content}</div>
                    
                    <div style="border-top: 1px dashed #ccc; padding-top: 10px;">
                        <textarea id="comment-${log.id}" style="width:100%; height: 60px; margin-bottom:5px;" placeholder="ì½”ë©˜íŠ¸ ì…ë ¥">${log.comment || ''}</textarea>
                        <button class="action-btn" style="font-size: 0.9rem; padding: 5px 15px;" onclick="saveComment(${log.id})">ì½”ë©˜íŠ¸ ì €ì¥</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function saveComment(id) {
            const logs = DB.getGrowthLogs();
            const logIndex = logs.findIndex(l => l.id === id);
            if (logIndex > -1) {
                const input = document.getElementById(`comment-${id}`);
                logs[logIndex].comment = input.value;
                DB.saveGrowthLogs(logs);
                alert("ì½”ë©˜íŠ¸ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

    </script>
</body>

</html>